{"version":3,"file":"app.js","sources":["App.vue","main.js"],"sourcesContent":["<script>\r\n\timport i18n from './utils/i18n.js'\r\n\t\r\n\texport default {\r\n\t\tonLaunch: function() {\r\n\t\t\tconsole.log('App Launch')\r\n\t\t\t// 初始化语言\r\n\t\t\tconst lang = i18n.getLanguage()\r\n\t\t\tconsole.log('Current language:', lang)\r\n\t\t\t\r\n\t\t\t// 检查用户登录状态\r\n\t\t\tthis.checkLoginStatus()\r\n\t\t},\r\n\t\tonShow: function() {\r\n\t\t\tconsole.log('App Show')\r\n\t\t},\r\n\t\tonHide: function() {\r\n\t\t\tconsole.log('App Hide')\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tasync checkLoginStatus() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// 检查是否有 uniIdToken\r\n\t\t\t\t\tconst uniIdToken = uni.getStorageSync('uni_id_token')\r\n\t\t\t\t\tif (!uniIdToken) {\r\n\t\t\t\t\t\t// 没有 token，检查是否有用户信息\r\n\t\t\t\t\t\tconst userInfo = uni.getStorageSync('userInfo')\r\n\t\t\t\t\t\tif (!userInfo || !userInfo._id) {\r\n\t\t\t\t\t\t\t// 没有用户信息，清除可能存在的旧数据\r\n\t\t\t\t\t\t\tuni.removeStorageSync('userInfo')\r\n\t\t\t\t\t\t\tuni.removeStorageSync('uni_id_token')\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 尝试获取当前用户信息验证 token 是否有效\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tconst uniIdCo = uniCloud.importObject('uni-id-co', {\r\n\t\t\t\t\t\t\tcustomUI: true\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tconst userInfo = await uniIdCo.checkToken()\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (userInfo.errCode === 0 && userInfo.userInfo) {\r\n\t\t\t\t\t\t\t// token 有效，更新用户信息\r\n\t\t\t\t\t\t\tconst user = userInfo.userInfo\r\n\t\t\t\t\t\t\tuni.setStorageSync('userInfo', {\r\n\t\t\t\t\t\t\t\t_id: user._id,\r\n\t\t\t\t\t\t\t\tusername: user.username || '',\r\n\t\t\t\t\t\t\t\temail: user.email || '',\r\n\t\t\t\t\t\t\t\tavatar: user.avatar_file?.url || '',\r\n\t\t\t\t\t\t\t\tschool: user.extend?.school || user.school || 'Rhode Island School of Design'\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// token 无效，清除登录信息\r\n\t\t\t\t\t\t\tuni.removeStorageSync('userInfo')\r\n\t\t\t\t\t\t\tuni.removeStorageSync('uni_id_token')\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\tconsole.error('检查登录状态失败:', error)\r\n\t\t\t\t\t\t// 如果检查失败，不清除数据，可能是网络问题\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error('检查登录状态出错:', error)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tglobalData: {\r\n\t\t\ti18n: i18n\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t/*每个页面公共css */\r\n\tpage {\r\n\t\tbackground-color: #f5f6f8;\r\n\t\tfont-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n\t}\r\n\t\r\n\t/* 主色调 */\r\n\t.primary-color {\r\n\t\tcolor: #00B4D8;\r\n\t}\r\n\t\r\n\t.primary-bg {\r\n\t\tbackground-color: #00B4D8;\r\n\t}\r\n\t\r\n\t/* 玻璃效果 */\r\n\t.glass-card {\r\n\t\tbackground: rgba(255, 255, 255, 0.9);\r\n\t\tbackdrop-filter: blur(12px);\r\n\t\t-webkit-backdrop-filter: blur(12px);\r\n\t\tborder: 1px solid rgba(255, 255, 255, 0.3);\r\n\t}\r\n\t\r\n\t/* 隐藏滚动条 */\r\n\t.hide-scrollbar::-webkit-scrollbar {\r\n\t\tdisplay: none;\r\n\t}\r\n\t\r\n\t.hide-scrollbar {\r\n\t\t-ms-overflow-style: none;\r\n\t\tscrollbar-width: none;\r\n\t}\r\n</style>\r\n","import App from './App'\nimport i18n from './utils/i18n.js'\n\n// #ifndef VUE3\nimport Vue from 'vue'\nimport './uni.promisify.adaptor'\nVue.config.productionTip = false\nVue.prototype.$t = i18n.t\nApp.mpType = 'app'\nconst app = new Vue({\n  ...App\n})\napp.$mount()\n// #endif\n\n// #ifdef VUE3\nimport { createSSRApp } from 'vue'\nexport function createApp() {\n  const app = createSSRApp(App)\n  // 全局注册 i18n\n  app.config.globalProperties.$t = i18n.t\n  app.config.globalProperties.$i18n = i18n\n  return {\n    app\n  }\n}\n// #endif"],"names":["uni","i18n","uniCloud","createSSRApp","App"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAGC,MAAK,YAAU;AAAA,EACd,UAAU,WAAW;AACpBA,kBAAAA,MAAA,MAAA,OAAA,gBAAY,YAAY;AAExB,UAAM,OAAOC,WAAI,KAAC,YAAY;AAC9BD,kBAAAA,MAAY,MAAA,OAAA,gBAAA,qBAAqB,IAAI;AAGrC,SAAK,iBAAiB;AAAA,EACtB;AAAA,EACD,QAAQ,WAAW;AAClBA,kBAAAA,MAAY,MAAA,OAAA,iBAAA,UAAU;AAAA,EACtB;AAAA,EACD,QAAQ,WAAW;AAClBA,kBAAAA,MAAY,MAAA,OAAA,iBAAA,UAAU;AAAA,EACtB;AAAA,EACD,SAAS;AAAA,IACR,MAAM,mBAAmB;;AACxB,UAAI;AAEH,cAAM,aAAaA,cAAAA,MAAI,eAAe,cAAc;AACpD,YAAI,CAAC,YAAY;AAEhB,gBAAM,WAAWA,cAAAA,MAAI,eAAe,UAAU;AAC9C,cAAI,CAAC,YAAY,CAAC,SAAS,KAAK;AAE/BA,0BAAG,MAAC,kBAAkB,UAAU;AAChCA,0BAAG,MAAC,kBAAkB,cAAc;AACpC;AAAA,UACD;AAAA,QACD;AAGA,YAAI;AACH,gBAAM,UAAUE,cAAAA,GAAS,aAAa,aAAa;AAAA,YAClD,UAAU;AAAA,WACV;AACD,gBAAM,WAAW,MAAM,QAAQ,WAAW;AAE1C,cAAI,SAAS,YAAY,KAAK,SAAS,UAAU;AAEhD,kBAAM,OAAO,SAAS;AACtBF,0BAAG,MAAC,eAAe,YAAY;AAAA,cAC9B,KAAK,KAAK;AAAA,cACV,UAAU,KAAK,YAAY;AAAA,cAC3B,OAAO,KAAK,SAAS;AAAA,cACrB,UAAQ,UAAK,gBAAL,mBAAkB,QAAO;AAAA,cACjC,UAAQ,UAAK,WAAL,mBAAa,WAAU,KAAK,UAAU;AAAA,aAC9C;AAAA,iBACK;AAENA,0BAAG,MAAC,kBAAkB,UAAU;AAChCA,0BAAG,MAAC,kBAAkB,cAAc;AAAA,UACrC;AAAA,QACC,SAAO,OAAO;AACfA,wBAAAA,sCAAc,aAAa,KAAK;AAAA,QAEjC;AAAA,MACC,SAAO,OAAO;AACfA,sBAAAA,MAAA,MAAA,SAAA,iBAAc,aAAa,KAAK;AAAA,MACjC;AAAA,IACD;AAAA,EACA;AAAA,EACD,YAAY;AAAA,IACX,MAAMC,WAAG;AAAA,EACV;AACD;ACpDM,SAAS,YAAY;AAC1B,QAAM,MAAME,cAAY,aAACC,SAAG;AAE5B,MAAI,OAAO,iBAAiB,KAAKH,WAAI,KAAC;AACtC,MAAI,OAAO,iBAAiB,QAAQA,WAAI;AACxC,SAAO;AAAA,IACL;AAAA,EACD;AACH;;;"}