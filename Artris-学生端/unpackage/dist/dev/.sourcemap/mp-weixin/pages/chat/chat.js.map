{"version":3,"file":"chat.js","sources":["pages/chat/chat.vue","pages/chat/chat.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"chat-page\">\n\t\t<!-- 导航栏 -->\n\t\t<view class=\"navbar\">\n\t\t\t<uni-icons type=\"left\" size=\"24\" color=\"#333\" @click=\"goBack\"></uni-icons>\n\t\t\t<text class=\"nav-title\">{{ otherUser?.username || '聊天' }}</text>\n\t\t\t<uni-icons type=\"list\" size=\"24\" color=\"#333\"></uni-icons>\n\t\t</view>\n\n\t\t<!-- 消息列表 -->\n\t\t<scroll-view class=\"message-list\" scroll-y=\"true\" :scroll-top=\"scrollTop\" scroll-with-animation>\n\t\t\t<view \n\t\t\t\tv-for=\"(message, index) in messages\" \n\t\t\t\t:key=\"index\"\n\t\t\t\tclass=\"message-item\"\n\t\t\t\t:class=\"{ 'message-right': message.from_user_id === currentUserId }\"\n\t\t\t>\n\t\t\t\t<view class=\"message-bubble\" :class=\"{ 'bubble-right': message.from_user_id === currentUserId }\">\n\t\t\t\t\t<text class=\"message-text\">{{ message.content }}</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</scroll-view>\n\n\t\t<!-- 输入栏 -->\n\t\t<view class=\"input-bar\">\n\t\t\t<input \n\t\t\t\tclass=\"message-input\" \n\t\t\t\tv-model=\"inputText\" \n\t\t\t\t:placeholder=\"$t('messages.inputPlaceholder')\"\n\t\t\t\t@confirm=\"sendMessage\"\n\t\t\t/>\n\t\t\t<button class=\"send-btn\" :class=\"{ 'send-btn-active': inputText.trim() }\" @click=\"sendMessage\" :disabled=\"!inputText.trim()\">\n\t\t\t\t<uni-icons type=\"right\" size=\"20\" color=\"#ffffff\"></uni-icons>\n\t\t\t</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tuserId: '',\n\t\t\t\totherUserId: '',\n\t\t\t\tcurrentUserId: '',\n\t\t\t\totherUser: {},\n\t\t\t\tmessages: [],\n\t\t\t\tinputText: '',\n\t\t\t\tscrollTop: 0\n\t\t\t}\n\t\t},\n\t\tonLoad(options) {\n\t\t\tif (options.userId) {\n\t\t\t\tthis.otherUserId = options.userId\n\t\t\t} else if (options.mentorId) {\n\t\t\t\tthis.otherUserId = options.mentorId\n\t\t\t}\n\t\t\tconst userInfo = uni.getStorageSync('userInfo') || {}\n\t\t\tthis.currentUserId = userInfo._id || 'test_student'\n\t\t\tthis.loadChatHistory()\n\t\t},\n\t\tmethods: {\n\t\t\tasync loadChatHistory() {\n\t\t\t\ttry {\n\t\t\t\t\tconst res = await uniCloud.callFunction({\n\t\t\t\t\t\tname: 'messages',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\taction: 'getChatHistory',\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tuser_id: this.currentUserId,\n\t\t\t\t\t\t\t\tother_user_id: this.otherUserId\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t\n\t\t\t\t\tif (res.result.code === 0) {\n\t\t\t\t\t\tthis.messages = res.result.data || []\n\t\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\t\tthis.scrollToBottom()\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('加载聊天记录失败:', error)\n\t\t\t\t}\n\t\t\t},\n\t\t\tasync sendMessage() {\n\t\t\t\tif (!this.inputText.trim()) return\n\t\t\t\t\n\t\t\t\ttry {\n\t\t\t\t\tconst res = await uniCloud.callFunction({\n\t\t\t\t\t\tname: 'messages',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\taction: 'send',\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tfrom_user_id: this.currentUserId,\n\t\t\t\t\t\t\t\tto_user_id: this.otherUserId,\n\t\t\t\t\t\t\t\tcontent: this.inputText\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t\n\t\t\t\t\tif (res.result.code === 0) {\n\t\t\t\t\t\tthis.inputText = ''\n\t\t\t\t\t\tthis.loadChatHistory()\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('发送消息失败:', error)\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '发送失败',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t},\n\t\t\tscrollToBottom() {\n\t\t\t\tthis.scrollTop = 99999\n\t\t\t},\n\t\t\tgoBack() {\n\t\t\t\tuni.navigateBack()\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style scoped>\n\t.chat-page {\n\t\theight: 100vh;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tbackground-color: #f5f6f8;\n\t\toverflow: hidden;\n\t}\n\n\t.navbar {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tpadding: 20rpx 32rpx;\n\t\tpadding-top: calc(20rpx + env(safe-area-inset-top));\n\t\tbackground: rgba(255, 255, 255, 0.95);\n\t\tbackdrop-filter: blur(10px);\n\t\tborder-bottom: 1px solid #e5e5e5;\n\t\tflex-shrink: 0;\n\t}\n\n\t.nav-title {\n\t\tfont-size: 32rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #333;\n\t}\n\n\t.message-list {\n\t\tflex: 1;\n\t\tpadding: 32rpx;\n\t\toverflow-y: auto;\n\t\tbox-sizing: border-box;\n\t\tmin-height: 0;\n\t}\n\n\t.message-item {\n\t\tmargin-bottom: 32rpx;\n\t\tdisplay: flex;\n\t}\n\n\t.message-item.message-right {\n\t\tjustify-content: flex-end;\n\t}\n\n\t.message-bubble {\n\t\tmax-width: 60%;\n\t\tbackground-color: #ffffff;\n\t\tborder-radius: 24rpx;\n\t\tborder-top-left-radius: 0;\n\t\tpadding: 24rpx;\n\t\tbox-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.05);\n\t\tword-wrap: break-word;\n\t\tword-break: break-all;\n\t}\n\n\t.bubble-right {\n\t\tbackground-color: #14b8a6;\n\t\tborder-top-left-radius: 24rpx;\n\t\tborder-top-right-radius: 0;\n\t}\n\n\t.message-text {\n\t\tfont-size: 28rpx;\n\t\tcolor: #333;\n\t\tline-height: 1.5;\n\t\tword-wrap: break-word;\n\t\tword-break: break-all;\n\t}\n\n\t.bubble-right .message-text {\n\t\tcolor: #ffffff;\n\t}\n\n\t.input-bar {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 16rpx;\n\t\tpadding: 24rpx 32rpx;\n\t\tpadding-bottom: calc(24rpx + env(safe-area-inset-bottom));\n\t\tbackground-color: #ffffff;\n\t\tborder-top: 1px solid #e5e5e5;\n\t\tflex-shrink: 0;\n\t}\n\n\t.message-input {\n\t\tflex: 1;\n\t\tbackground-color: #f5f6f8;\n\t\tborder: none;\n\t\tborder-radius: 50rpx;\n\t\tpadding: 20rpx 32rpx;\n\t\tfont-size: 28rpx;\n\t}\n\n\t.send-btn {\n\t\twidth: 80rpx;\n\t\theight: 80rpx;\n\t\tborder-radius: 50%;\n\t\tbackground-color: #ccc;\n\t\tborder: none;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\ttransition: all 0.3s;\n\t}\n\n\t.send-btn-active {\n\t\tbackground-color: #00B4D8 !important;\n\t}\n\n\t.send-btn:active {\n\t\ttransform: scale(0.95);\n\t}\n\n\t.send-btn-active:active {\n\t\tbackground-color: #0099cc !important;\n\t}\n\n\t.send-btn[disabled] {\n\t\topacity: 0.6;\n\t}\n</style>\n","import MiniProgramPage from '/Users/tinajiang/Documents/HBuilderProjects/Artris-学生端/pages/chat/chat.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":";;AAuCC,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,QAAQ;AAAA,MACR,aAAa;AAAA,MACb,eAAe;AAAA,MACf,WAAW,CAAE;AAAA,MACb,UAAU,CAAE;AAAA,MACZ,WAAW;AAAA,MACX,WAAW;AAAA,IACZ;AAAA,EACA;AAAA,EACD,OAAO,SAAS;AACf,QAAI,QAAQ,QAAQ;AACnB,WAAK,cAAc,QAAQ;AAAA,eACjB,QAAQ,UAAU;AAC5B,WAAK,cAAc,QAAQ;AAAA,IAC5B;AACA,UAAM,WAAWA,cAAG,MAAC,eAAe,UAAU,KAAK,CAAC;AACpD,SAAK,gBAAgB,SAAS,OAAO;AACrC,SAAK,gBAAgB;AAAA,EACrB;AAAA,EACD,SAAS;AAAA,IACR,MAAM,kBAAkB;AACvB,UAAI;AACH,cAAM,MAAM,MAAMC,cAAQ,GAAC,aAAa;AAAA,UACvC,MAAM;AAAA,UACN,MAAM;AAAA,YACL,QAAQ;AAAA,YACR,MAAM;AAAA,cACL,SAAS,KAAK;AAAA,cACd,eAAe,KAAK;AAAA,YACrB;AAAA,UACD;AAAA,SACA;AAED,YAAI,IAAI,OAAO,SAAS,GAAG;AAC1B,eAAK,WAAW,IAAI,OAAO,QAAQ,CAAC;AACpC,eAAK,UAAU,MAAM;AACpB,iBAAK,eAAe;AAAA,WACpB;AAAA,QACF;AAAA,MACC,SAAO,OAAO;AACfD,sBAAAA,kDAAc,aAAa,KAAK;AAAA,MACjC;AAAA,IACA;AAAA,IACD,MAAM,cAAc;AACnB,UAAI,CAAC,KAAK,UAAU,KAAM;AAAE;AAE5B,UAAI;AACH,cAAM,MAAM,MAAMC,cAAQ,GAAC,aAAa;AAAA,UACvC,MAAM;AAAA,UACN,MAAM;AAAA,YACL,QAAQ;AAAA,YACR,MAAM;AAAA,cACL,cAAc,KAAK;AAAA,cACnB,YAAY,KAAK;AAAA,cACjB,SAAS,KAAK;AAAA,YACf;AAAA,UACD;AAAA,SACA;AAED,YAAI,IAAI,OAAO,SAAS,GAAG;AAC1B,eAAK,YAAY;AACjB,eAAK,gBAAgB;AAAA,QACtB;AAAA,MACC,SAAO,OAAO;AACfD,sBAAAA,mDAAc,WAAW,KAAK;AAC9BA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,SACN;AAAA,MACF;AAAA,IACA;AAAA,IACD,iBAAiB;AAChB,WAAK,YAAY;AAAA,IACjB;AAAA,IACD,SAAS;AACRA,oBAAAA,MAAI,aAAa;AAAA,IAClB;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvHD,GAAG,WAAW,eAAe;"}