{"version":3,"file":"order-confirm.js","sources":["pages/order-confirm/order-confirm.vue","pages/order-confirm/order-confirm.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"order-confirm-page\">\n\t\t<!-- 导航栏 -->\n\t\t<view class=\"navbar\">\n\t\t\t<uni-icons type=\"left\" size=\"24\" color=\"#333\" @click=\"goBack\"></uni-icons>\n\t\t\t<text class=\"nav-title\">{{ $t('booking.confirmOrder') }}</text>\n\t\t\t<view class=\"nav-placeholder\"></view>\n\t\t</view>\n\n\t\t<view class=\"content\">\n\t\t\t<!-- 导师信息卡片 -->\n\t\t\t<view class=\"mentor-card\">\n\t\t\t\t<view class=\"mentor-info\">\n\t\t\t\t\t<image class=\"mentor-avatar\" :src=\"mentor.avatar\" mode=\"aspectFill\"></image>\n\t\t\t\t\t<view class=\"mentor-details\">\n\t\t\t\t\t\t<text class=\"mentor-name\">{{ mentor.name }}</text>\n\t\t\t\t\t\t<text class=\"course-name\">{{ $t('booking.portfolioGuidance') }}</text>\n\t\t\t\t\t\t<text class=\"appointment-time\">{{ appointmentDate }} {{ appointmentTime }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<!-- 费用明细 -->\n\t\t\t<view class=\"price-card\">\n\t\t\t\t<view class=\"price-row\">\n\t\t\t\t\t<text class=\"price-label\">{{ $t('booking.courseFee') }}</text>\n\t\t\t\t\t<text class=\"price-value\">¥{{ orderPrice.toFixed(2) }}</text>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"price-row discount\">\n\t\t\t\t\t<text class=\"price-label\">{{ $t('booking.coupon') }}</text>\n\t\t\t\t\t<text class=\"price-value discount-value\">-¥{{ discount.toFixed(2) }}</text>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"divider\"></view>\n\t\t\t\t<view class=\"price-row total\">\n\t\t\t\t\t<text class=\"price-label\">{{ $t('booking.totalAmount') }}</text>\n\t\t\t\t\t<text class=\"price-value total-value\">¥{{ totalAmount.toFixed(2) }}</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 底部支付栏 -->\n\t\t<view class=\"footer-bar\">\n\t\t\t<view class=\"total-info\">\n\t\t\t\t<text class=\"total-label\">{{ $t('booking.totalAmount') }}</text>\n\t\t\t\t<text class=\"total-price\">¥{{ totalAmount.toFixed(2) }}</text>\n\t\t\t</view>\n\t\t\t<button class=\"pay-btn\" @click=\"handlePay\">\n\t\t\t\t{{ $t('booking.payNow') }}\n\t\t\t</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tmentorId: '',\n\t\t\t\tappointmentDate: '',\n\t\t\t\tappointmentTime: '',\n\t\t\t\tmentor: {},\n\t\t\t\torderPrice: 380,\n\t\t\t\tdiscount: 20,\n\t\t\t\ttotalAmount: 360\n\t\t\t}\n\t\t},\n\t\tonLoad(options) {\n\t\t\tif (options.mentorId) {\n\t\t\t\tthis.mentorId = options.mentorId\n\t\t\t}\n\t\t\tif (options.date) {\n\t\t\t\tthis.appointmentDate = options.date\n\t\t\t}\n\t\t\tif (options.time) {\n\t\t\t\tthis.appointmentTime = options.time\n\t\t\t}\n\t\t\tthis.loadMentorInfo()\n\t\t},\n\t\tmethods: {\n\t\t\tasync loadMentorInfo() {\n\t\t\t\ttry {\n\t\t\t\t\tconst res = await uniCloud.callFunction({\n\t\t\t\t\t\tname: 'mentors',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\taction: 'getDetail',\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tmentorId: this.mentorId\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t\n\t\t\t\t\tif (res.result.code === 0) {\n\t\t\t\t\t\tthis.mentor = res.result.data\n\t\t\t\t\t\tthis.orderPrice = this.mentor.price || 380\n\t\t\t\t\t\tthis.totalAmount = this.orderPrice - this.discount\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('加载导师信息失败:', error)\n\t\t\t\t}\n\t\t\t},\n\t\t\tgoBack() {\n\t\t\t\tuni.navigateBack()\n\t\t\t},\n\t\t\tasync handlePay() {\n\t\t\t\t// 检查登录状态\n\t\t\t\tconst userInfo = uni.getStorageSync('userInfo')\n\t\t\t\tconst uniIdToken = uni.getStorageSync('uni_id_token')\n\t\t\t\t\n\t\t\t\tif (!userInfo || !userInfo._id || !uniIdToken) {\n\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\ttitle: '提示',\n\t\t\t\t\t\tcontent: '请先登录后再创建订单',\n\t\t\t\t\t\tconfirmText: '去登录',\n\t\t\t\t\t\tcancelText: '取消',\n\t\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\t\tif (res.confirm) {\n\t\t\t\t\t\t\t\tuni.navigateTo({\n\t\t\t\t\t\t\t\t\turl: '/pages/login/login'\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\ttry {\n\t\t\t\t\t// 使用云对象创建订单\n\t\t\t\t\tconst ordersObj = uniCloud.importObject('orders')\n\t\t\t\t\t\n\t\t\t\t\tconst createRes = await ordersObj.create({\n\t\t\t\t\t\tmentor_id: this.mentorId,\n\t\t\t\t\t\tappointment_date: this.appointmentDate,\n\t\t\t\t\t\tappointment_time: this.appointmentTime,\n\t\t\t\t\t\tduration: 60,\n\t\t\t\t\t\tcourse_name: '作品集指导',\n\t\t\t\t\t\tprice: this.orderPrice,\n\t\t\t\t\t\tdiscount: this.discount,\n\t\t\t\t\t\ttotal_amount: this.totalAmount,\n\t\t\t\t\t\tuser_id: userInfo._id // 备用方案：如果 token 无法获取，使用用户ID\n\t\t\t\t\t})\n\t\t\t\t\t\n\t\t\t\t\tif (createRes.code === 0) {\n\t\t\t\t\t\tuni.navigateTo({\n\t\t\t\t\t\t\turl: `/pages/success/success?orderId=${createRes.data.order_id}&orderNo=${createRes.data.order_no}&mentorName=${this.mentor.name}`\n\t\t\t\t\t\t})\n\t\t\t\t\t} else {\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: createRes.message || '创建订单失败',\n\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('创建订单失败:', error)\n\t\t\t\t\t\n\t\t\t\t\t// 处理用户未登录的情况\n\t\t\t\t\tif (error.message && error.message.includes('未登录')) {\n\t\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\t\ttitle: '提示',\n\t\t\t\t\t\t\tcontent: '请先登录后再创建订单',\n\t\t\t\t\t\t\tshowCancel: false\n\t\t\t\t\t\t})\n\t\t\t\t\t} else {\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: error.message || '创建订单失败',\n\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style scoped>\n\t.order-confirm-page {\n\t\tmin-height: 100vh;\n\t\tbackground-color: #f5f6f8;\n\t\tpadding-bottom: 160rpx;\n\t}\n\n\t.navbar {\n\t\tposition: sticky;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tpadding: 20rpx 32rpx;\n\t\tbackground: rgba(255, 255, 255, 0.95);\n\t\tbackdrop-filter: blur(10px);\n\t\tborder-bottom: 1px solid #e5e5e5;\n\t\tz-index: 100;\n\t}\n\n\t.nav-title {\n\t\tfont-size: 36rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #333;\n\t}\n\n\t.nav-placeholder {\n\t\twidth: 48rpx;\n\t}\n\n\t.content {\n\t\tpadding: 32rpx;\n\t}\n\n\t.mentor-card {\n\t\tbackground: rgba(255, 255, 255, 0.9);\n\t\tbackdrop-filter: blur(12px);\n\t\tborder-radius: 24rpx;\n\t\tpadding: 40rpx;\n\t\tmargin-bottom: 32rpx;\n\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\n\t}\n\n\t.mentor-info {\n\t\tdisplay: flex;\n\t\tgap: 32rpx;\n\t}\n\n\t.mentor-avatar {\n\t\twidth: 128rpx;\n\t\theight: 128rpx;\n\t\tborder-radius: 16rpx;\n\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\n\t}\n\n\t.mentor-details {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 8rpx;\n\t}\n\n\t.mentor-name {\n\t\tfont-size: 36rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #333;\n\t}\n\n\t.course-name {\n\t\tfont-size: 28rpx;\n\t\tcolor: #666;\n\t}\n\n\t.appointment-time {\n\t\tfont-size: 24rpx;\n\t\tcolor: #999;\n\t\tmargin-top: 8rpx;\n\t}\n\n\t.price-card {\n\t\tbackground-color: #ffffff;\n\t\tborder-radius: 24rpx;\n\t\tpadding: 40rpx;\n\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\n\t}\n\n\t.price-row {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 24rpx;\n\t}\n\n\t.price-label {\n\t\tfont-size: 28rpx;\n\t\tcolor: #666;\n\t}\n\n\t.price-value {\n\t\tfont-size: 28rpx;\n\t\tcolor: #333;\n\t}\n\n\t.price-row.discount .price-value {\n\t\tcolor: #ff6b6b;\n\t}\n\n\t.divider {\n\t\theight: 1px;\n\t\tbackground-color: #e5e5e5;\n\t\tmargin: 24rpx 0;\n\t}\n\n\t.price-row.total {\n\t\tmargin-bottom: 0;\n\t}\n\n\t.total-value {\n\t\tfont-size: 40rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #00B4D8;\n\t}\n\n\t.footer-bar {\n\t\tposition: fixed;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbackground: rgba(255, 255, 255, 0.95);\n\t\tbackdrop-filter: blur(12px);\n\t\tborder-top: 1px solid #e5e5e5;\n\t\tpadding: 32rpx;\n\t\tpadding-bottom: calc(32rpx + env(safe-area-inset-bottom));\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tz-index: 100;\n\t}\n\n\t.total-info {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\n\t.total-label {\n\t\tfont-size: 24rpx;\n\t\tcolor: #999;\n\t\tmargin-bottom: 8rpx;\n\t}\n\n\t.total-price {\n\t\tfont-size: 48rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #00B4D8;\n\t}\n\n\t.pay-btn {\n\t\tbackground-color: #00B4D8;\n\t\tcolor: #ffffff;\n\t\tborder: none;\n\t\tborder-radius: 50rpx;\n\t\tpadding: 28rpx 80rpx;\n\t\tfont-size: 32rpx;\n\t\tfont-weight: bold;\n\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 180, 216, 0.3);\n\t}\n</style>\n","import MiniProgramPage from '/Users/tinajiang/Documents/HBuilderProjects/Artris-学生端/pages/order-confirm/order-confirm.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","uni"],"mappings":"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"}