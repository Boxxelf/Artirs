{"version":3,"file":"messages.js","sources":["pages/messages/messages.vue","pages/messages/messages.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"messages-page\">\n\t\t<!-- 头部 -->\n\t\t<view class=\"header\">\n\t\t\t<view class=\"header-content\">\n\t\t\t\t<text class=\"header-title\">{{ $t('messages.title') }}</text>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 消息列表 -->\n\t\t<view class=\"message-list\">\n\t\t\t<view \n\t\t\t\tv-for=\"conversation in conversations\" \n\t\t\t\t:key=\"conversation.other_user_id\"\n\t\t\t\tclass=\"message-item\"\n\t\t\t\t@click=\"goToChat(conversation.other_user_id)\"\n\t\t\t>\n\t\t\t\t<view class=\"avatar-container\">\n\t\t\t\t\t<image v-if=\"conversation.other_user?.avatar_file?.url\" class=\"avatar\" :src=\"conversation.other_user.avatar_file.url\" mode=\"aspectFill\"></image>\n\t\t\t\t\t<view v-else class=\"avatar-placeholder\">\n\t\t\t\t\t\t<uni-icons type=\"contact-filled\" size=\"40\" color=\"#00B4D8\"></uni-icons>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"message-content\">\n\t\t\t\t\t<view class=\"message-header\">\n\t\t\t\t\t\t<text class=\"user-name\">{{ conversation.other_user?.username || '用户' }}</text>\n\t\t\t\t\t\t<text class=\"message-time\">{{ formatTime(conversation.create_date) }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<text class=\"message-text\">{{ conversation.content }}</text>\n\t\t\t\t</view>\n\t\t\t\t<view v-if=\"conversation.unread\" class=\"unread-badge\"></view>\n\t\t\t</view>\n\n\t\t\t<view v-if=\"loading\" class=\"loading\">\n\t\t\t\t<text>{{ $t('common.loading') }}</text>\n\t\t\t</view>\n\n\t\t\t<view v-if=\"!loading && conversations.length === 0\" class=\"empty\">\n\t\t\t\t<text>{{ $t('messages.noMessages') }}</text>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 底部导航 -->\n\t\t<BottomNav />\n\t</view>\n</template>\n\n<script>\n\timport BottomNav from '@/components/BottomNav/BottomNav.vue'\n\t\n\texport default {\n\t\tcomponents: {\n\t\t\tBottomNav\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tconversations: [],\n\t\t\t\tloading: false\n\t\t\t}\n\t\t},\n\t\tonLoad() {\n\t\t\tthis.loadConversations()\n\t\t},\n\t\tonShow() {\n\t\t\tthis.loadConversations()\n\t\t},\n\t\tmethods: {\n\t\t\tasync loadConversations() {\n\t\t\t\tthis.loading = true\n\t\t\t\ttry {\n\t\t\t\t\tconst userInfo = uni.getStorageSync('userInfo') || {}\n\t\t\t\t\tconst res = await uniCloud.callFunction({\n\t\t\t\t\t\tname: 'messages',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\taction: 'getList',\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tuser_id: userInfo._id || 'test_student'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t\n\t\t\t\t\tif (res.result.code === 0) {\n\t\t\t\t\t\tthis.conversations = res.result.data || []\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('加载消息失败:', error)\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '加载失败',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t} finally {\n\t\t\t\t\tthis.loading = false\n\t\t\t\t}\n\t\t\t},\n\t\t\tgoToChat(userId) {\n\t\t\t\tuni.navigateTo({\n\t\t\t\t\turl: `/pages/chat/chat?userId=${userId}`\n\t\t\t\t})\n\t\t\t},\n\t\t\tformatTime(timestamp) {\n\t\t\t\tif (!timestamp) return ''\n\t\t\t\tconst date = new Date(timestamp)\n\t\t\t\tconst now = new Date()\n\t\t\t\tconst diff = now - date\n\t\t\t\tconst minutes = Math.floor(diff / 60000)\n\t\t\t\t\n\t\t\t\tif (minutes < 1) return '刚刚'\n\t\t\t\tif (minutes < 60) return `${minutes}分钟前`\n\t\t\t\tif (minutes < 1440) return `${Math.floor(minutes / 60)}小时前`\n\t\t\t\treturn `${date.getMonth() + 1}-${date.getDate()}`\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style scoped>\n\t.messages-page {\n\t\tmin-height: 100vh;\n\t\tbackground-color: #ffffff;\n\t\tpadding-bottom: 120rpx;\n\t}\n\n\t.header {\n\t\tbackground-color: #ffffff;\n\t\tpadding: 32rpx;\n\t\tpadding-top: calc(32rpx + env(safe-area-inset-top));\n\t\tborder-bottom: 1px solid #e5e5e5;\n\t}\n\n\t.header-content {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n\n\t.header-title {\n\t\tfont-size: 48rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #333;\n\t}\n\n\t.message-list {\n\t\tpadding: 0 32rpx;\n\t}\n\n\t.message-item {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 24rpx;\n\t\tpadding: 32rpx 0;\n\t\tborder-bottom: 1px solid #f0f0f0;\n\t\tposition: relative;\n\t}\n\n\t.avatar-container {\n\t\tposition: relative;\n\t}\n\n\t.avatar {\n\t\twidth: 112rpx;\n\t\theight: 112rpx;\n\t\tborder-radius: 50%;\n\t}\n\n\t.avatar-placeholder {\n\t\twidth: 112rpx;\n\t\theight: 112rpx;\n\t\tborder-radius: 50%;\n\t\tbackground-color: #f0f0f0;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n\n\t.message-content {\n\t\tflex: 1;\n\t}\n\n\t.message-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 8rpx;\n\t}\n\n\t.user-name {\n\t\tfont-size: 32rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #333;\n\t}\n\n\t.message-time {\n\t\tfont-size: 24rpx;\n\t\tcolor: #999;\n\t}\n\n\t.message-text {\n\t\tfont-size: 28rpx;\n\t\tcolor: #666;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t\tmax-width: 400rpx;\n\t}\n\n\t.unread-badge {\n\t\twidth: 16rpx;\n\t\theight: 16rpx;\n\t\tborder-radius: 50%;\n\t\tbackground-color: #ff6b6b;\n\t}\n\n\t.loading, .empty {\n\t\ttext-align: center;\n\t\tpadding: 64rpx;\n\t\tcolor: #999;\n\t\tfont-size: 28rpx;\n\t}\n\n</style>\n","import MiniProgramPage from '/Users/tinajiang/Documents/HBuilderProjects/Artris-学生端/pages/messages/messages.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":";;AAgDC,MAAK,YAAa,MAAW;AAE7B,MAAK,YAAU;AAAA,EACd,YAAY;AAAA,IACX;AAAA,EACA;AAAA,EACD,OAAO;AACN,WAAO;AAAA,MACN,eAAe,CAAE;AAAA,MACjB,SAAS;AAAA,IACV;AAAA,EACA;AAAA,EACD,SAAS;AACR,SAAK,kBAAkB;AAAA,EACvB;AAAA,EACD,SAAS;AACR,SAAK,kBAAkB;AAAA,EACvB;AAAA,EACD,SAAS;AAAA,IACR,MAAM,oBAAoB;AACzB,WAAK,UAAU;AACf,UAAI;AACH,cAAM,WAAWA,cAAG,MAAC,eAAe,UAAU,KAAK,CAAC;AACpD,cAAM,MAAM,MAAMC,cAAQ,GAAC,aAAa;AAAA,UACvC,MAAM;AAAA,UACN,MAAM;AAAA,YACL,QAAQ;AAAA,YACR,MAAM;AAAA,cACL,SAAS,SAAS,OAAO;AAAA,YAC1B;AAAA,UACD;AAAA,SACA;AAED,YAAI,IAAI,OAAO,SAAS,GAAG;AAC1B,eAAK,gBAAgB,IAAI,OAAO,QAAQ,CAAC;AAAA,QAC1C;AAAA,MACC,SAAO,OAAO;AACfD,sBAAAA,0DAAc,WAAW,KAAK;AAC9BA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,SACN;AAAA,MACF,UAAU;AACT,aAAK,UAAU;AAAA,MAChB;AAAA,IACA;AAAA,IACD,SAAS,QAAQ;AAChBA,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK,2BAA2B,MAAM;AAAA,OACtC;AAAA,IACD;AAAA,IACD,WAAW,WAAW;AACrB,UAAI,CAAC;AAAW,eAAO;AACvB,YAAM,OAAO,IAAI,KAAK,SAAS;AAC/B,YAAM,MAAM,oBAAI,KAAK;AACrB,YAAM,OAAO,MAAM;AACnB,YAAM,UAAU,KAAK,MAAM,OAAO,GAAK;AAEvC,UAAI,UAAU;AAAG,eAAO;AACxB,UAAI,UAAU;AAAI,eAAO,GAAG,OAAO;AACnC,UAAI,UAAU;AAAM,eAAO,GAAG,KAAK,MAAM,UAAU,EAAE,CAAC;AACtD,aAAO,GAAG,KAAK,SAAW,IAAE,CAAC,IAAI,KAAK,QAAO,CAAE;AAAA,IAChD;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/GD,GAAG,WAAW,eAAe;"}