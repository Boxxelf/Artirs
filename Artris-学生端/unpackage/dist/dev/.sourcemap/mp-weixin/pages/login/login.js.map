{"version":3,"file":"login.js","sources":["pages/login/login.vue","pages/login/login.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"login-page\">\n\t\t<!-- Logo 和欢迎文字 -->\n\t\t<view class=\"header\">\n\t\t\t<image class=\"logo\" src=\"/static/ArtrisStudent.png\" mode=\"aspectFit\"></image>\n\t\t\t<text class=\"welcome-title\">{{ $t('login.welcome') }}</text>\n\t\t\t<text class=\"welcome-subtitle\">{{ $t('login.subtitle') }}</text>\n\t\t</view>\n\n\t\t<!-- 登录表单 -->\n\t\t<view class=\"form-container\">\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<view class=\"input-wrapper\">\n\t\t\t\t\t<uni-icons type=\"person\" size=\"20\" color=\"#999\"></uni-icons>\n\t\t\t\t\t<input \n\t\t\t\t\t\tclass=\"input\" \n\t\t\t\t\t\ttype=\"text\" \n\t\t\t\t\t\tv-model=\"formData.username\" \n\t\t\t\t\t\t:placeholder=\"$t('login.usernamePlaceholder')\"\n\t\t\t\t\t\tplaceholder-style=\"color: #999\"\n\t\t\t\t\t/>\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<view class=\"input-wrapper\">\n\t\t\t\t\t<uni-icons type=\"locked\" size=\"20\" color=\"#999\"></uni-icons>\n\t\t\t\t\t<input \n\t\t\t\t\t\tclass=\"input\" \n\t\t\t\t\t\ttype=\"password\" \n\t\t\t\t\t\tv-model=\"formData.password\" \n\t\t\t\t\t\t:placeholder=\"$t('login.passwordPlaceholder')\"\n\t\t\t\t\t\tplaceholder-style=\"color: #999\"\n\t\t\t\t\t\t@confirm=\"handleLogin\"\n\t\t\t\t\t/>\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<view class=\"forgot-password\" @click=\"handleForgotPassword\">\n\t\t\t\t<text class=\"forgot-text\">{{ $t('login.forgotPassword') }}</text>\n\t\t\t</view>\n\n\t\t\t<button \n\t\t\t\tclass=\"login-btn\" \n\t\t\t\t:class=\"{ 'login-btn-disabled': !canLogin }\"\n\t\t\t\t:disabled=\"!canLogin || loading\"\n\t\t\t\t@click=\"handleLogin\"\n\t\t\t>\n\t\t\t\t<text v-if=\"loading\">{{ $t('common.loading') }}</text>\n\t\t\t\t<text v-else>{{ $t('login.loginButton') }}</text>\n\t\t\t</button>\n\n\t\t\t<view class=\"register-link\" @click=\"goToRegister\">\n\t\t\t\t<text class=\"register-text\">{{ $t('login.registerLink') }}</text>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tformData: {\n\t\t\t\t\tusername: '',\n\t\t\t\t\tpassword: ''\n\t\t\t\t},\n\t\t\t\tloading: false\n\t\t\t}\n\t\t},\n\t\tcomputed: {\n\t\t\tcanLogin() {\n\t\t\t\treturn this.formData.username.trim() && this.formData.password.trim()\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tasync handleLogin() {\n\t\t\t\tif (!this.canLogin || this.loading) return\n\n\t\t\t\t// 验证输入\n\t\t\t\tif (!this.formData.username.trim()) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: this.$t('login.usernameRequired'),\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tif (!this.formData.password.trim()) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: this.$t('login.passwordRequired'),\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tthis.loading = true\n\n\t\t\t\ttry {\n\t\t\t\t\t// 使用 uni-id 进行登录\n\t\t\t\t\tconst uniIdCo = uniCloud.importObject('uni-id-co', {\n\t\t\t\t\t\tcustomUI: true\n\t\t\t\t\t})\n\n\t\t\t\t\t// 判断是邮箱还是用户名\n\t\t\t\t\tconst isEmail = this.formData.username.includes('@')\n\t\t\t\t\t\n\t\t\t\t\tlet loginResult\n\t\t\t\t\tif (isEmail) {\n\t\t\t\t\t\t// 邮箱登录\n\t\t\t\t\t\tloginResult = await uniIdCo.loginByEmail({\n\t\t\t\t\t\t\temail: this.formData.username,\n\t\t\t\t\t\t\tpassword: this.formData.password\n\t\t\t\t\t\t})\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// 用户名登录\n\t\t\t\t\t\tloginResult = await uniIdCo.login({\n\t\t\t\t\t\t\tusername: this.formData.username,\n\t\t\t\t\t\t\tpassword: this.formData.password\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\tif (loginResult.errCode === 0) {\n\t\t\t\t\t\t// 登录成功，获取用户信息\n\t\t\t\t\t\tconst userInfo = loginResult.userInfo || {}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// 保存 token（从云对象返回的 token 需要手动保存）\n\t\t\t\t\t\tif (loginResult.token) {\n\t\t\t\t\t\t\tuni.setStorageSync('uni_id_token', loginResult.token)\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// 保存用户信息到本地存储\n\t\t\t\t\t\tuni.setStorageSync('userInfo', {\n\t\t\t\t\t\t\t_id: userInfo._id || loginResult.uid,\n\t\t\t\t\t\t\tusername: userInfo.username || this.formData.username,\n\t\t\t\t\t\t\temail: userInfo.email || '',\n\t\t\t\t\t\t\tavatar: userInfo.avatar_file?.url || '',\n\t\t\t\t\t\t\tschool: userInfo.extend?.school || userInfo.school || 'Rhode Island School of Design'\n\t\t\t\t\t\t})\n\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: this.$t('login.loginSuccess'),\n\t\t\t\t\t\t\ticon: 'success'\n\t\t\t\t\t\t})\n\n\t\t\t\t\t\t// 延迟跳转，让用户看到成功提示\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t// 检查是否有返回路径\n\t\t\t\t\t\t\tconst pages = getCurrentPages()\n\t\t\t\t\t\t\tif (pages.length > 1) {\n\t\t\t\t\t\t\t\t// 如果有上一页，返回上一页\n\t\t\t\t\t\t\t\tuni.navigateBack()\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// 否则跳转到首页\n\t\t\t\t\t\t\t\tuni.reLaunch({\n\t\t\t\t\t\t\t\t\turl: '/pages/home/home'\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 1500)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(loginResult.errMsg || this.$t('login.loginError'))\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('登录失败:', error)\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: error.message || this.$t('login.loginFailed'),\n\t\t\t\t\t\ticon: 'none',\n\t\t\t\t\t\tduration: 2000\n\t\t\t\t\t})\n\t\t\t\t} finally {\n\t\t\t\t\tthis.loading = false\n\t\t\t\t}\n\t\t\t},\n\t\t\tgoToRegister() {\n\t\t\t\tuni.navigateTo({\n\t\t\t\t\turl: '/pages/register/register'\n\t\t\t\t})\n\t\t\t},\n\t\t\thandleForgotPassword() {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '功能开发中',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style scoped>\n\t.login-page {\n\t\tmin-height: 100vh;\n\t\tbackground: linear-gradient(180deg, #00B4D8 0%, #ffffff 50%);\n\t\tpadding: 0 64rpx;\n\t\tpadding-top: calc(120rpx + env(safe-area-inset-top));\n\t}\n\n\t.header {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tmargin-bottom: 120rpx;\n\t}\n\n\t.logo {\n\t\twidth: 200rpx;\n\t\theight: 200rpx;\n\t\tmargin-bottom: 48rpx;\n\t}\n\n\t.welcome-title {\n\t\tfont-size: 56rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #ffffff;\n\t\tmargin-bottom: 16rpx;\n\t\ttext-align: center;\n\t}\n\n\t.welcome-subtitle {\n\t\tfont-size: 28rpx;\n\t\tcolor: rgba(255, 255, 255, 0.9);\n\t\ttext-align: center;\n\t}\n\n\t.form-container {\n\t\tbackground-color: #ffffff;\n\t\tborder-radius: 48rpx 48rpx 0 0;\n\t\tpadding: 64rpx 48rpx;\n\t\tpadding-bottom: calc(64rpx + env(safe-area-inset-bottom));\n\t\tbox-shadow: 0 -8rpx 32rpx rgba(0, 0, 0, 0.1);\n\t}\n\n\t.form-item {\n\t\tmargin-bottom: 32rpx;\n\t}\n\n\t.input-wrapper {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tbackground-color: #f5f6f8;\n\t\tborder-radius: 24rpx;\n\t\tpadding: 24rpx 32rpx;\n\t\tgap: 24rpx;\n\t}\n\n\t.input {\n\t\tflex: 1;\n\t\tfont-size: 32rpx;\n\t\tcolor: #333;\n\t}\n\n\t.forgot-password {\n\t\tdisplay: flex;\n\t\tjustify-content: flex-end;\n\t\tmargin-bottom: 48rpx;\n\t}\n\n\t.forgot-text {\n\t\tfont-size: 24rpx;\n\t\tcolor: #00B4D8;\n\t}\n\n\t.login-btn {\n\t\twidth: 100%;\n\t\tbackground-color: #00B4D8;\n\t\tcolor: #ffffff;\n\t\tborder: none;\n\t\tborder-radius: 24rpx;\n\t\tpadding: 32rpx;\n\t\tfont-size: 32rpx;\n\t\tfont-weight: bold;\n\t\tmargin-bottom: 32rpx;\n\t\tbox-shadow: 0 8rpx 24rpx rgba(0, 180, 216, 0.3);\n\t}\n\n\t.login-btn-disabled {\n\t\tbackground-color: #cccccc;\n\t\tbox-shadow: none;\n\t}\n\n\t.register-link {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\tmargin-top: 32rpx;\n\t}\n\n\t.register-text {\n\t\tfont-size: 28rpx;\n\t\tcolor: #00B4D8;\n\t}\n</style>\n","import MiniProgramPage from '/Users/tinajiang/Documents/HBuilderProjects/Artris-学生端/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":"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"}