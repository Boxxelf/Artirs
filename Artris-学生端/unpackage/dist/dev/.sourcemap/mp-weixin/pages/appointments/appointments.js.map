{"version":3,"file":"appointments.js","sources":["pages/appointments/appointments.vue","pages/appointments/appointments.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"appointments-page\">\n\t\t<!-- 头部 -->\n\t\t<view class=\"header\">\n\t\t\t<text class=\"header-title\">{{ $t('appointments.title') }}</text>\n\t\t\t<view class=\"tabs\">\n\t\t\t\t<view \n\t\t\t\t\tclass=\"tab-item\"\n\t\t\t\t\t:class=\"{ active: activeTab === 'upcoming' }\"\n\t\t\t\t\t@click=\"switchTab('upcoming')\"\n\t\t\t\t>\n\t\t\t\t\t{{ $t('appointments.upcoming') }}\n\t\t\t\t</view>\n\t\t\t\t<view \n\t\t\t\t\tclass=\"tab-item\"\n\t\t\t\t\t:class=\"{ active: activeTab === 'completed' }\"\n\t\t\t\t\t@click=\"switchTab('completed')\"\n\t\t\t\t>\n\t\t\t\t\t{{ $t('appointments.completed') }}\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 预约列表 -->\n\t\t<view class=\"appointment-list\">\n\t\t\t<view \n\t\t\t\tv-for=\"appointment in appointments\" \n\t\t\t\t:key=\"appointment._id\"\n\t\t\t\tclass=\"appointment-card\"\n\t\t\t>\n\t\t\t\t<view class=\"appointment-header\">\n\t\t\t\t\t<view class=\"mentor-info\">\n\t\t\t\t\t\t<image class=\"mentor-avatar\" :src=\"appointment.mentor?.avatar\" mode=\"aspectFill\"></image>\n\t\t\t\t\t\t<view class=\"mentor-details\">\n\t\t\t\t\t\t\t<text class=\"mentor-name\">{{ appointment.mentor?.name }}</text>\n\t\t\t\t\t\t\t<text class=\"mentor-specialty\">{{ appointment.mentor?.specialties?.[0] || 'UI/UX 专家' }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"status-badge\" :class=\"appointment.status\">\n\t\t\t\t\t\t{{ getStatusText(appointment.status) }}\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"appointment-content\">\n\t\t\t\t\t<text class=\"course-name\">{{ appointment.course_name || '作品集指导' }}</text>\n\t\t\t\t\t<view class=\"appointment-time\">\n\t\t\t\t\t\t<text>{{ appointment.appointment_date }}</text>\n\t\t\t\t\t\t<text>{{ appointment.appointment_time }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"appointment-footer\" v-if=\"appointment.status === 'confirmed'\">\n\t\t\t\t\t<button class=\"enter-btn\" @click=\"enterClassroom(appointment)\">\n\t\t\t\t\t\t<uni-icons type=\"videocam\" size=\"16\" color=\"#ffffff\"></uni-icons>\n\t\t\t\t\t\t{{ $t('appointments.enterClassroom') }}\n\t\t\t\t\t</button>\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<view v-if=\"loading\" class=\"loading\">\n\t\t\t\t<text>{{ $t('common.loading') }}</text>\n\t\t\t</view>\n\n\t\t\t<view v-if=\"!loading && appointments.length === 0\" class=\"empty\">\n\t\t\t\t<text>{{ $t('common.noData') }}</text>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 底部导航 -->\n\t\t<BottomNav />\n\t</view>\n</template>\n\n<script>\n\timport BottomNav from '@/components/BottomNav/BottomNav.vue'\n\t\n\texport default {\n\t\tcomponents: {\n\t\t\tBottomNav\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tactiveTab: 'upcoming',\n\t\t\t\tappointments: [],\n\t\t\t\tloading: false\n\t\t\t}\n\t\t},\n\t\tonLoad() {\n\t\t\tthis.loadAppointments()\n\t\t},\n\t\tonShow() {\n\t\t\tthis.loadAppointments()\n\t\t},\n\t\tmethods: {\n\t\t\tasync loadAppointments() {\n\t\t\t\tthis.loading = true\n\t\t\t\ttry {\n\t\t\t\t\t// 检查登录状态\n\t\t\t\t\tconst token = uni.getStorageSync('uni_id_token')\n\t\t\t\t\tconst userInfo = uni.getStorageSync('userInfo')\n\t\t\t\t\t\n\t\t\t\t\tconsole.log('预约页面 - token:', token ? '存在' : '不存在')\n\t\t\t\t\tconsole.log('预约页面 - userInfo:', userInfo)\n\t\t\t\t\t\n\t\t\t\t\tif (!token || !userInfo || !userInfo._id) {\n\t\t\t\t\t\tconsole.warn('预约页面 - 用户未登录，显示空列表')\n\t\t\t\t\t\tthis.appointments = []\n\t\t\t\t\t\tthis.loading = false\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tconst status = this.activeTab === 'upcoming' ? 'confirmed' : 'completed'\n\t\t\t\t\t\n\t\t\t\t\t// 使用云对象获取订单列表\n\t\t\t\t\t// uniCloud 会自动从本地存储中读取 uni_id_token 并传递给云对象\n\t\t\t\t\tconst ordersObj = uniCloud.importObject('orders')\n\t\t\t\t\tconst res = await ordersObj.getList({\n\t\t\t\t\t\trole: 'student',\n\t\t\t\t\t\tstatus: status,\n\t\t\t\t\t\tuser_id: userInfo._id // 备用方案：如果 token 无法获取，使用用户ID\n\t\t\t\t\t})\n\t\t\t\t\t\n\t\t\t\t\tconsole.log('预约页面 - 订单列表响应:', res)\n\t\t\t\t\t\n\t\t\t\t\tif (res.code === 0) {\n\t\t\t\t\t\tthis.appointments = res.data || []\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// 如果是未登录错误，不显示 toast，只显示空列表\n\t\t\t\t\t\tif (res.message && res.message.includes('未登录')) {\n\t\t\t\t\t\t\tconsole.warn('预约页面 - 云对象返回未登录')\n\t\t\t\t\t\t\tthis.appointments = []\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\ttitle: res.message || '加载失败',\n\t\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('加载订单失败:', error)\n\t\t\t\t\t\n\t\t\t\t\t// 处理用户未登录的情况\n\t\t\t\t\tif (error.message && error.message.includes('未登录')) {\n\t\t\t\t\t\tconsole.warn('预约页面 - 捕获到未登录错误')\n\t\t\t\t\t\tthis.appointments = []\n\t\t\t\t\t} else {\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: error.message || '加载失败',\n\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tthis.loading = false\n\t\t\t\t}\n\t\t\t},\n\t\t\tswitchTab(tab) {\n\t\t\t\tthis.activeTab = tab\n\t\t\t\tthis.loadAppointments()\n\t\t\t},\n\t\t\tgetStatusText(status) {\n\t\t\t\tconst statusMap = {\n\t\t\t\t\tpending: '待确认',\n\t\t\t\t\tconfirmed: '即将开始',\n\t\t\t\t\tcompleted: '已完成',\n\t\t\t\t\tcancelled: '已取消'\n\t\t\t\t}\n\t\t\t\treturn statusMap[status] || status\n\t\t\t},\n\t\t\tenterClassroom(appointment) {\n\t\t\t\tif (appointment.zoom_join_url) {\n\t\t\t\t\t// 在小程序中打开外部链接\n\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\ttitle: '提示',\n\t\t\t\t\t\tcontent: '请使用邮件中的 Zoom 链接进入课堂',\n\t\t\t\t\t\tshowCancel: false\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '会议链接未生成',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style scoped>\n\t.appointments-page {\n\t\tmin-height: 100vh;\n\t\tbackground-color: #f5f6f8;\n\t\tpadding-bottom: 120rpx;\n\t}\n\n\t.header {\n\t\tbackground: rgba(255, 255, 255, 0.95);\n\t\tbackdrop-filter: blur(10px);\n\t\tborder-bottom: 1px solid #e5e5e5;\n\t\tposition: sticky;\n\t\ttop: 0;\n\t\tz-index: 100;\n\t}\n\n\t.header-title {\n\t\tdisplay: block;\n\t\tfont-size: 36rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #333;\n\t\tpadding: 24rpx 32rpx;\n\t}\n\n\t.tabs {\n\t\tdisplay: flex;\n\t\tpadding: 0 32rpx;\n\t\tborder-bottom: 1px solid #f0f0f0;\n\t}\n\n\t.tab-item {\n\t\tflex: 1;\n\t\ttext-align: center;\n\t\tpadding: 24rpx 0;\n\t\tfont-size: 28rpx;\n\t\tcolor: #999;\n\t\tfont-weight: 500;\n\t\tposition: relative;\n\t}\n\n\t.tab-item.active {\n\t\tcolor: #00B4D8;\n\t\tfont-weight: 600;\n\t}\n\n\t.tab-item.active::after {\n\t\tcontent: '';\n\t\tposition: absolute;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\theight: 4rpx;\n\t\tbackground-color: #00B4D8;\n\t}\n\n\t.appointment-list {\n\t\tpadding: 32rpx;\n\t}\n\n\t.appointment-card {\n\t\tbackground-color: #ffffff;\n\t\tborder-radius: 24rpx;\n\t\tpadding: 32rpx;\n\t\tmargin-bottom: 32rpx;\n\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\n\t}\n\n\t.appointment-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 24rpx;\n\t}\n\n\t.mentor-info {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 24rpx;\n\t}\n\n\t.mentor-avatar {\n\t\twidth: 96rpx;\n\t\theight: 96rpx;\n\t\tborder-radius: 50%;\n\t}\n\n\t.mentor-details {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 8rpx;\n\t}\n\n\t.mentor-name {\n\t\tfont-size: 32rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #333;\n\t}\n\n\t.mentor-specialty {\n\t\tfont-size: 24rpx;\n\t\tcolor: #999;\n\t}\n\n\t.status-badge {\n\t\tpadding: 8rpx 20rpx;\n\t\tborder-radius: 50rpx;\n\t\tfont-size: 20rpx;\n\t\tfont-weight: bold;\n\t\ttext-transform: uppercase;\n\t}\n\n\t.status-badge.confirmed {\n\t\tbackground-color: rgba(0, 180, 216, 0.1);\n\t\tcolor: #00B4D8;\n\t}\n\n\t.status-badge.completed {\n\t\tbackground-color: rgba(76, 175, 80, 0.1);\n\t\tcolor: #4CAF50;\n\t}\n\n\t.appointment-content {\n\t\tbackground-color: #f5f6f8;\n\t\tborder-radius: 16rpx;\n\t\tpadding: 24rpx;\n\t\tmargin-bottom: 24rpx;\n\t}\n\n\t.course-name {\n\t\tdisplay: block;\n\t\tfont-size: 28rpx;\n\t\tfont-weight: 600;\n\t\tcolor: #333;\n\t\tmargin-bottom: 16rpx;\n\t}\n\n\t.appointment-time {\n\t\tdisplay: flex;\n\t\tgap: 32rpx;\n\t\tfont-size: 24rpx;\n\t\tcolor: #666;\n\t}\n\n\t.appointment-footer {\n\t\tdisplay: flex;\n\t\tjustify-content: flex-end;\n\t}\n\n\t.enter-btn {\n\t\tbackground-color: #14b8a6;\n\t\tcolor: #ffffff;\n\t\tborder: none;\n\t\tborder-radius: 16rpx;\n\t\tpadding: 16rpx 32rpx;\n\t\tfont-size: 24rpx;\n\t\tfont-weight: 600;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8rpx;\n\t}\n\n\t.loading, .empty {\n\t\ttext-align: center;\n\t\tpadding: 64rpx;\n\t\tcolor: #999;\n\t\tfont-size: 28rpx;\n\t}\n\n</style>\n","import MiniProgramPage from '/Users/tinajiang/Documents/HBuilderProjects/Artris-学生端/pages/appointments/appointments.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":";;AAwEC,MAAK,YAAa,MAAW;AAE7B,MAAK,YAAU;AAAA,EACd,YAAY;AAAA,IACX;AAAA,EACA;AAAA,EACD,OAAO;AACN,WAAO;AAAA,MACN,WAAW;AAAA,MACX,cAAc,CAAE;AAAA,MAChB,SAAS;AAAA,IACV;AAAA,EACA;AAAA,EACD,SAAS;AACR,SAAK,iBAAiB;AAAA,EACtB;AAAA,EACD,SAAS;AACR,SAAK,iBAAiB;AAAA,EACtB;AAAA,EACD,SAAS;AAAA,IACR,MAAM,mBAAmB;AACxB,WAAK,UAAU;AACf,UAAI;AAEH,cAAM,QAAQA,cAAAA,MAAI,eAAe,cAAc;AAC/C,cAAM,WAAWA,cAAAA,MAAI,eAAe,UAAU;AAE9CA,sBAAY,MAAA,MAAA,OAAA,8CAAA,iBAAiB,QAAQ,OAAO,KAAK;AACjDA,sBAAAA,iEAAY,oBAAoB,QAAQ;AAExC,YAAI,CAAC,SAAS,CAAC,YAAY,CAAC,SAAS,KAAK;AACzCA,wBAAAA,MAAa,MAAA,QAAA,8CAAA,oBAAoB;AACjC,eAAK,eAAe,CAAC;AACrB,eAAK,UAAU;AACf;AAAA,QACD;AAEA,cAAM,SAAS,KAAK,cAAc,aAAa,cAAc;AAI7D,cAAM,YAAYC,cAAAA,GAAS,aAAa,QAAQ;AAChD,cAAM,MAAM,MAAM,UAAU,QAAQ;AAAA,UACnC,MAAM;AAAA,UACN;AAAA,UACA,SAAS,SAAS;AAAA;AAAA,SAClB;AAEDD,sBAAAA,MAAA,MAAA,OAAA,8CAAY,kBAAkB,GAAG;AAEjC,YAAI,IAAI,SAAS,GAAG;AACnB,eAAK,eAAe,IAAI,QAAQ,CAAC;AAAA,eAC3B;AAEN,cAAI,IAAI,WAAW,IAAI,QAAQ,SAAS,KAAK,GAAG;AAC/CA,0BAAAA,MAAa,MAAA,QAAA,8CAAA,iBAAiB;AAC9B,iBAAK,eAAe,CAAC;AAAA,iBACf;AACNA,0BAAAA,MAAI,UAAU;AAAA,cACb,OAAO,IAAI,WAAW;AAAA,cACtB,MAAM;AAAA,aACN;AAAA,UACF;AAAA,QACD;AAAA,MACC,SAAO,OAAO;AACfA,sBAAAA,mEAAc,WAAW,KAAK;AAG9B,YAAI,MAAM,WAAW,MAAM,QAAQ,SAAS,KAAK,GAAG;AACnDA,wBAAAA,MAAa,MAAA,QAAA,8CAAA,iBAAiB;AAC9B,eAAK,eAAe,CAAC;AAAA,eACf;AACNA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO,MAAM,WAAW;AAAA,YACxB,MAAM;AAAA,WACN;AAAA,QACF;AAAA,MACD,UAAU;AACT,aAAK,UAAU;AAAA,MAChB;AAAA,IACA;AAAA,IACD,UAAU,KAAK;AACd,WAAK,YAAY;AACjB,WAAK,iBAAiB;AAAA,IACtB;AAAA,IACD,cAAc,QAAQ;AACrB,YAAM,YAAY;AAAA,QACjB,SAAS;AAAA,QACT,WAAW;AAAA,QACX,WAAW;AAAA,QACX,WAAW;AAAA,MACZ;AACA,aAAO,UAAU,MAAM,KAAK;AAAA,IAC5B;AAAA,IACD,eAAe,aAAa;AAC3B,UAAI,YAAY,eAAe;AAE9BA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,SAAS;AAAA,UACT,YAAY;AAAA,SACZ;AAAA,aACK;AACNA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,SACN;AAAA,MACF;AAAA,IACD;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrLD,GAAG,WAAW,eAAe;"}