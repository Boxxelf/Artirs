{"version":3,"file":"register.js","sources":["pages/register/register.vue","pages/register/register.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"register-page\">\n\t\t<!-- 导航栏 -->\n\t\t<view class=\"navbar\">\n\t\t\t<uni-icons type=\"left\" size=\"24\" color=\"#333\" @click=\"goBack\"></uni-icons>\n\t\t\t<text class=\"nav-title\">{{ $t('register.title') }}</text>\n\t\t\t<view class=\"nav-placeholder\"></view>\n\t\t</view>\n\n\t\t<!-- Logo 和欢迎文字 -->\n\t\t<view class=\"header\">\n\t\t\t<image class=\"logo\" src=\"/static/ArtrisStudent.png\" mode=\"aspectFit\"></image>\n\t\t\t<text class=\"welcome-title\">{{ $t('register.createAccount') }}</text>\n\t\t\t<text class=\"welcome-subtitle\">{{ $t('register.subtitle') }}</text>\n\t\t</view>\n\n\t\t<!-- 注册表单 -->\n\t\t<view class=\"form-container\">\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<view class=\"input-wrapper\">\n\t\t\t\t\t<uni-icons type=\"person\" size=\"20\" color=\"#999\"></uni-icons>\n\t\t\t\t\t<input \n\t\t\t\t\t\tclass=\"input\" \n\t\t\t\t\t\ttype=\"text\" \n\t\t\t\t\t\tv-model=\"formData.username\" \n\t\t\t\t\t\t:placeholder=\"$t('register.usernamePlaceholder')\"\n\t\t\t\t\t\tplaceholder-style=\"color: #999\"\n\t\t\t\t\t/>\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<view class=\"input-wrapper\">\n\t\t\t\t\t<uni-icons type=\"email\" size=\"20\" color=\"#999\"></uni-icons>\n\t\t\t\t\t<input \n\t\t\t\t\t\tclass=\"input\" \n\t\t\t\t\t\ttype=\"text\" \n\t\t\t\t\t\tv-model=\"formData.email\" \n\t\t\t\t\t\t:placeholder=\"$t('register.emailPlaceholder')\"\n\t\t\t\t\t\tplaceholder-style=\"color: #999\"\n\t\t\t\t\t/>\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<view class=\"input-wrapper\">\n\t\t\t\t\t<uni-icons type=\"locked\" size=\"20\" color=\"#999\"></uni-icons>\n\t\t\t\t\t<input \n\t\t\t\t\t\tclass=\"input\" \n\t\t\t\t\t\ttype=\"password\" \n\t\t\t\t\t\tv-model=\"formData.password\" \n\t\t\t\t\t\t:placeholder=\"$t('register.passwordPlaceholder')\"\n\t\t\t\t\t\tplaceholder-style=\"color: #999\"\n\t\t\t\t\t/>\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<view class=\"input-wrapper\">\n\t\t\t\t\t<uni-icons type=\"locked\" size=\"20\" color=\"#999\"></uni-icons>\n\t\t\t\t\t<input \n\t\t\t\t\t\tclass=\"input\" \n\t\t\t\t\t\ttype=\"password\" \n\t\t\t\t\t\tv-model=\"formData.confirmPassword\" \n\t\t\t\t\t\t:placeholder=\"$t('register.confirmPasswordPlaceholder')\"\n\t\t\t\t\t\tplaceholder-style=\"color: #999\"\n\t\t\t\t\t\t@confirm=\"handleRegister\"\n\t\t\t\t\t/>\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<view class=\"input-wrapper\">\n\t\t\t\t\t<uni-icons type=\"home\" size=\"20\" color=\"#999\"></uni-icons>\n\t\t\t\t\t<input \n\t\t\t\t\t\tclass=\"input\" \n\t\t\t\t\t\ttype=\"text\" \n\t\t\t\t\t\tv-model=\"formData.school\" \n\t\t\t\t\t\t:placeholder=\"$t('register.schoolPlaceholder')\"\n\t\t\t\t\t\tplaceholder-style=\"color: #999\"\n\t\t\t\t\t/>\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<button \n\t\t\t\tclass=\"register-btn\" \n\t\t\t\t:class=\"{ 'register-btn-disabled': !canRegister }\"\n\t\t\t\t:disabled=\"!canRegister || loading\"\n\t\t\t\t@click=\"handleRegister\"\n\t\t\t>\n\t\t\t\t<text v-if=\"loading\">{{ $t('common.loading') }}</text>\n\t\t\t\t<text v-else>{{ $t('register.registerButton') }}</text>\n\t\t\t</button>\n\n\t\t\t<view class=\"login-link\" @click=\"goToLogin\">\n\t\t\t\t<text class=\"login-text\">{{ $t('register.loginLink') }}</text>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tformData: {\n\t\t\t\t\tusername: '',\n\t\t\t\t\temail: '',\n\t\t\t\t\tpassword: '',\n\t\t\t\t\tconfirmPassword: '',\n\t\t\t\t\tschool: ''\n\t\t\t\t},\n\t\t\t\tloading: false\n\t\t\t}\n\t\t},\n\t\tcomputed: {\n\t\t\tcanRegister() {\n\t\t\t\treturn this.formData.username.trim() && \n\t\t\t\t       this.formData.email.trim() && \n\t\t\t\t       this.formData.password.trim() && \n\t\t\t\t       this.formData.confirmPassword.trim() &&\n\t\t\t\t       this.formData.school.trim()\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tvalidateForm() {\n\t\t\t\tif (!this.formData.username.trim()) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '请输入用户名',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn false\n\t\t\t\t}\n\n\t\t\t\tif (!this.formData.email.trim()) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '请输入邮箱',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn false\n\t\t\t\t}\n\n\t\t\t\t// 验证邮箱格式\n\t\t\t\tconst emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n\t\t\t\tif (!emailRegex.test(this.formData.email)) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: this.$t('register.emailInvalid'),\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn false\n\t\t\t\t}\n\n\t\t\t\tif (!this.formData.password.trim()) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '请输入密码',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn false\n\t\t\t\t}\n\n\t\t\t\tif (this.formData.password.length < 6) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: this.$t('register.passwordTooShort'),\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn false\n\t\t\t\t}\n\n\t\t\t\tif (this.formData.password !== this.formData.confirmPassword) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: this.$t('register.passwordMismatch'),\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn false\n\t\t\t\t}\n\n\t\t\t\tif (!this.formData.school.trim()) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '请输入学校名称',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn false\n\t\t\t\t}\n\n\t\t\t\treturn true\n\t\t\t},\n\t\t\tasync handleRegister() {\n\t\t\t\tif (!this.canRegister || this.loading) return\n\n\t\t\t\tif (!this.validateForm()) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tthis.loading = true\n\n\t\t\t\ttry {\n\t\t\t\t\t// 使用 uni-id 进行注册\n\t\t\t\t\tconst uniIdCo = uniCloud.importObject('uni-id-co', {\n\t\t\t\t\t\tcustomUI: true\n\t\t\t\t\t})\n\n\t\t\t\t\tconst registerResult = await uniIdCo.register({\n\t\t\t\t\t\tusername: this.formData.username,\n\t\t\t\t\t\temail: this.formData.email,\n\t\t\t\t\t\tpassword: this.formData.password,\n\t\t\t\t\t\tnickname: this.formData.username,\n\t\t\t\t\t\textend: {\n\t\t\t\t\t\t\tschool: this.formData.school\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\n\t\t\t\t\tif (registerResult.errCode === 0) {\n\t\t\t\t\t\t// 注册成功，直接使用返回的用户信息和 token（不需要再次登录）\n\t\t\t\t\t\t// 保存 token\n\t\t\t\t\t\tif (registerResult.token) {\n\t\t\t\t\t\t\tuni.setStorageSync('uni_id_token', registerResult.token)\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// 保存用户信息\n\t\t\t\t\t\tconst userInfo = registerResult.userInfo || {}\n\t\t\t\t\t\tuni.setStorageSync('userInfo', {\n\t\t\t\t\t\t\t_id: userInfo._id || registerResult.uid,\n\t\t\t\t\t\t\tusername: userInfo.username || this.formData.username,\n\t\t\t\t\t\t\temail: userInfo.email || this.formData.email,\n\t\t\t\t\t\t\tavatar: userInfo.avatar_file?.url || '',\n\t\t\t\t\t\t\tschool: userInfo.extend?.school || this.formData.school\n\t\t\t\t\t\t})\n\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: this.$t('register.registerSuccess'),\n\t\t\t\t\t\t\ticon: 'success'\n\t\t\t\t\t\t})\n\n\t\t\t\t\t\t// 延迟跳转\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tuni.reLaunch({\n\t\t\t\t\t\t\t\turl: '/pages/home/home'\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}, 1500)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(registerResult.errMsg || this.$t('register.registerFailed'))\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('注册失败:', error)\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: error.message || this.$t('register.registerFailed'),\n\t\t\t\t\t\ticon: 'none',\n\t\t\t\t\t\tduration: 2000\n\t\t\t\t\t})\n\t\t\t\t} finally {\n\t\t\t\t\tthis.loading = false\n\t\t\t\t}\n\t\t\t},\n\t\t\tgoToLogin() {\n\t\t\t\tuni.navigateBack()\n\t\t\t},\n\t\t\tgoBack() {\n\t\t\t\tuni.navigateBack()\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style scoped>\n\t.register-page {\n\t\tmin-height: 100vh;\n\t\tbackground-color: #f5f6f8;\n\t}\n\n\t.navbar {\n\t\tposition: sticky;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tpadding: 20rpx 32rpx;\n\t\tbackground: rgba(255, 255, 255, 0.95);\n\t\tbackdrop-filter: blur(10px);\n\t\tborder-bottom: 1px solid #e5e5e5;\n\t\tz-index: 100;\n\t\tpadding-top: calc(20rpx + env(safe-area-inset-top));\n\t}\n\n\t.nav-title {\n\t\tfont-size: 36rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #333;\n\t}\n\n\t.nav-placeholder {\n\t\twidth: 48rpx;\n\t}\n\n\t.header {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tpadding: 64rpx 64rpx 48rpx;\n\t\tbackground: linear-gradient(180deg, #00B4D8 0%, transparent 100%);\n\t}\n\n\t.logo {\n\t\twidth: 160rpx;\n\t\theight: 160rpx;\n\t\tmargin-bottom: 32rpx;\n\t}\n\n\t.welcome-title {\n\t\tfont-size: 48rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #333;\n\t\tmargin-bottom: 16rpx;\n\t\ttext-align: center;\n\t}\n\n\t.welcome-subtitle {\n\t\tfont-size: 28rpx;\n\t\tcolor: #666;\n\t\ttext-align: center;\n\t}\n\n\t.form-container {\n\t\tbackground-color: #ffffff;\n\t\tborder-radius: 48rpx 48rpx 0 0;\n\t\tpadding: 64rpx 48rpx;\n\t\tpadding-bottom: calc(64rpx + env(safe-area-inset-bottom));\n\t\tmargin-top: -48rpx;\n\t\tbox-shadow: 0 -8rpx 32rpx rgba(0, 0, 0, 0.1);\n\t}\n\n\t.form-item {\n\t\tmargin-bottom: 32rpx;\n\t}\n\n\t.input-wrapper {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tbackground-color: #f5f6f8;\n\t\tborder-radius: 24rpx;\n\t\tpadding: 24rpx 32rpx;\n\t\tgap: 24rpx;\n\t}\n\n\t.input {\n\t\tflex: 1;\n\t\tfont-size: 32rpx;\n\t\tcolor: #333;\n\t}\n\n\t.register-btn {\n\t\twidth: 100%;\n\t\tbackground-color: #00B4D8;\n\t\tcolor: #ffffff;\n\t\tborder: none;\n\t\tborder-radius: 24rpx;\n\t\tpadding: 32rpx;\n\t\tfont-size: 32rpx;\n\t\tfont-weight: bold;\n\t\tmargin-top: 32rpx;\n\t\tmargin-bottom: 32rpx;\n\t\tbox-shadow: 0 8rpx 24rpx rgba(0, 180, 216, 0.3);\n\t}\n\n\t.register-btn-disabled {\n\t\tbackground-color: #cccccc;\n\t\tbox-shadow: none;\n\t}\n\n\t.login-link {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\tmargin-top: 32rpx;\n\t}\n\n\t.login-text {\n\t\tfont-size: 28rpx;\n\t\tcolor: #00B4D8;\n\t}\n</style>\n","import MiniProgramPage from '/Users/tinajiang/Documents/HBuilderProjects/Artris-学生端/pages/register/register.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":"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"}